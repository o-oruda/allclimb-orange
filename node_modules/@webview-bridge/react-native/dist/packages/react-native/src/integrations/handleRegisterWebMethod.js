"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handleRegisterWebMethod = void 0;
const util_1 = require("../../../../shared/util/src");
const error_1 = require("../error");
const handleRegisterWebMethod = (emitter, webview, bridgeNames, responseTimeout) => {
    return bridgeNames.reduce((acc, methodName) => {
        acc[methodName] = async (...args) => {
            const eventId = (0, util_1.createRandomId)();
            return Promise.race([
                (0, util_1.createResolver)({
                    emitter,
                    methodName,
                    eventId,
                    evaluate: () => {
                        webview.injectJavaScript(`
              window.webEmitter.emit('${methodName}', '${eventId}', ${JSON.stringify(args)});
            
              true;
              `);
                    },
                    failHandler: new error_1.WebMethodError(methodName),
                }),
                (0, util_1.timeout)(responseTimeout),
            ]);
        };
        return acc;
    }, {});
};
exports.handleRegisterWebMethod = handleRegisterWebMethod;
